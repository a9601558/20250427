# 在线学习平台

## 项目概述

此项目是一个在线学习平台，允许用户查看、购买和完成各种题库练习。使用React前端和Express后端构建，支持实时互动功能。

## 技术栈

- **前端**: React, TypeScript, Vite, Tailwind CSS
- **后端**: Node.js, Express, TypeScript
- **数据库**: MySQL (Sequelize ORM)
- **实时通信**: Socket.IO
- **部署**: Nginx, PM2

## 项目结构

- `src/`: 前端源代码
  - `components/`: React组件
  - `contexts/`: React上下文(Context)
  - `services/`: API服务
  - `utils/`: 工具函数
- `server/`: 后端源代码
  - `src/controllers/`: 控制器
  - `src/models/`: 数据库模型
  - `src/routes/`: API路由
  - `src/middleware/`: 中间件
  - `src/migrations/`: 数据库迁移脚本

## 开发指南

### 安装依赖

```bash
# 安装前端依赖
npm install

# 安装后端依赖
cd server && npm install
```

### 开发环境运行

```bash
# 运行前端开发服务器
npm run dev

# 运行后端开发服务器
npm run start
```

### 数据库操作

```bash
# 运行迁移
npm run db:migrate

# 回滚迁移
npm run db:migrate:undo

# 重置数据库 (慎用)
npm run db:reset
```

### 代码规范

项目使用ESLint和Prettier强制执行代码规范，详见[CODING_STYLE.md](./CODING_STYLE.md)。

```bash
# 检查代码
npm run lint

# 自动修复代码规范问题
npm run lint:fix

# 格式化代码
npm run format
```

### 部署

生产环境使用PM2管理Node.js进程：

```bash
# 构建前后端代码
npm run build:all

# 使用PM2启动服务
pm2 start ecosystem.config.js
```

## 最近的优化

项目最近进行了全面优化，详见[PROJECT_OPTIMIZATION.md](./PROJECT_OPTIMIZATION.md)：

1. 统一了代码规范和命名约定
2. 清理了数据库冗余索引
3. 统一了API服务调用方式
4. 重构了配置文件
5. 添加了代码质量工具

## 主要功能

- 题库浏览与购买
- 题目练习与答题
- 学习进度追踪
- 会员权限管理
- 兑换码系统

## 数据库同步机制

本项目实现了全自动的数据库同步机制：

1. **启动时检查**：服务器启动时会自动检查数据库结构是否与代码定义一致
2. **自动迁移**：如果检测到不一致，系统会自动运行迁移脚本同步数据库结构
3. **兼容性保障**：迁移设计确保向前兼容，不会丢失或破坏现有数据
4. **部署集成**：宝塔面板部署脚本集成了数据库同步功能

## 贡献指南

1. Fork 该项目
2. 创建新的功能分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'Add some amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 创建Pull Request

## 许可证

MIT

## 功能特点

### 用户系统
- 用户注册和登录
- 个人资料管理
- 普通用户和管理员角色

### 题库系统
- 多种分类的题库
- 单选题和多选题支持
- 题目随机顺序
- 答题记录和进度保存
- 正确率统计

### 付费系统
- 免费题库和付费题库
- 付费题库支持试用部分题目
- Stripe集成进行支付处理
- 购买记录管理
- 有效期为6个月的访问权限

### 兑换码系统
- 管理员可生成兑换码
- 支持自定义有效期的兑换码
- 兑换码可用于获取付费题库访问权限
- 兑换记录管理

### 管理功能
- 用户管理：查看、添加、编辑、删除用户
- 题库管理：创建、编辑、删除题库
- 首页内容管理：编辑网站显示内容
- 兑换码管理：生成和跟踪兑换码使用情况

## 用户指南

### 作为普通用户

1. **浏览题库**
   - 在首页可以查看所有可用题库
   - 免费题库可直接访问
   - 付费题库显示价格和试用题目数量

2. **答题功能**
   - 选择题库开始答题
   - 查看答题进度和正确率
   - 复习错题和已答题目

3. **付费内容访问**
   - 在付费题库中，可以免费试用部分题目
   - 通过支付购买完整题库（有效期6个月）
   - 使用兑换码获取题库访问权限

4. **个人中心**
   - 查看学习进度
   - 管理购买记录
   - 查看兑换码使用记录
   - 账户设置（开发中）

### 作为管理员

1. **用户管理**
   - 查看所有用户
   - 添加、编辑、删除用户

2. **题库管理**
   - 创建新题库和题目
   - 设置免费/付费状态
   - 编辑现有题库

3. **兑换码管理**
   - 为特定题库生成兑换码
   - 设置兑换码有效期
   - 批量生成兑换码
   - 跟踪兑换码使用情况

4. **内容管理**
   - 编辑首页内容
   - 管理网站设置

## 技术栈

- 前端：React、TypeScript、Tailwind CSS
- 状态管理：React Context API
- 路由：React Router
- 支付处理：Stripe
- 样式：Tailwind CSS

## 开发与运行

1. 安装依赖:
```
npm install
```

2. 启动开发服务器:
```
npm run dev
```

3. 构建生产版本:
```
npm run build
```

## 兑换码和支付流程

### 兑换码流程
1. 管理员在管理后台为特定题库生成兑换码
2. 用户在题库页面点击"使用兑换码"
3. 输入有效兑换码后，获取该题库的完整访问权限
4. 系统记录兑换情况和有效期

### 支付流程
1. 用户在题库页面点击"购买完整题库"
2. 弹出支付窗口，用户输入支付信息
3. 支付成功后，用户获得该题库6个月的访问权限
4. 系统记录购买记录和到期时间
